<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />

    <title>Async Library Script Loading Demo</title>

    <script src="./component-bar.js" async></script>
    <script src="./runtime.js" async></script>
    <script src="./component-foo.js" async></script>
  </head>
  <body>
    <h1>Async Library Script Loading Demo</h1>

    <p>
      The following demonstrates how a library can be built in which its scripts
      loaded are all loaded asynchronously (with both <code>async</code> and
      <code>type=module</code>). These scripts can be wired together so that
      they always run in the same order regardless of the order in which the
      scripts were downloaded from the network. This is the approach taken by
      scripts loaded for <a href="https://amp.dev/">AMP project</a>. It's also
      commonly seen in the
      <a
        href="https://stackoverflow.com/questions/2538252/what-is-var-gaq-gaq-for"
        >Google Analytics Async Tracking Code</a
      >.
    </p>

    <pre id="log">Loading...</pre>

    <script type="module">
      (self.MyAsyncLib = self.MyAsyncLib || []).push([
        "baz",
        (lib) => {
          lib.log("Component baz initialized! (#3, depends on foo and bar)");
        },
        ["foo", "bar"],
      ]);
    </script>

    <hr />
    <address><a href="https://weston.ruter.net/">@westonruter</a><br><time datetime="2023-04">April 2023</time></address>
  </body>
</html>
